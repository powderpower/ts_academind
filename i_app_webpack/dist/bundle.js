!function(e){var t={};function n(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(r,s,function(t){return e[t]}.bind(null,s));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="dist",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);class r{constructor(e,t,n=!0,r){const s=document.getElementById(e),i=document.getElementById(t);if(!(s instanceof HTMLTemplateElement))throw new Error("Template element is not defined!");if(!(i instanceof HTMLElement))throw new Error("Host element is not defined!s");this.templateElement=s,this.hostElement=i;const o=document.importNode(this.templateElement.content,!0);this.element=o.firstElementChild,r&&(this.element.id=r),this.attach(n)}attach(e){const t=e?"afterbegin":"beforeend";this.hostElement.insertAdjacentElement(t,this.element)}}function s(e,t,n){const r=n.value;return{configurable:!0,get(){return r.bind(this)}}}function i(e){let t=!0;return e.required&&(t=t&&0!==e.value.toString().trim().length),null!=e.minLength&&"string"==typeof e.value&&(t=t&&e.value.length>=e.minLength),null!=e.maxLength&&"string"==typeof e.value&&(t=t&&e.value.length<=e.maxLength),null!=e.min&&"number"==typeof e.value&&(t=t&&e.value>=e.min),null!=e.max&&"number"==typeof e.value&&(t=t&&e.value<=e.max),t}var o,l=function(e,t,n,r){var s,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o};class a extends r{constructor(e){super("project-input","app",!0,"user-input"),this.projectStateContainer=e,this.titleInputElement=this.element.querySelector("#title"),this.descriptionInputElement=this.element.querySelector("#description"),this.peopleInputElement=this.element.querySelector("#people"),this.configure()}gatherUserInput(){const e=this.titleInputElement.value,t=this.descriptionInputElement.value,n=this.peopleInputElement.value,r={value:t,required:!0,minLength:5},s={value:+n,required:!0,min:1,max:5};if(i({value:e,required:!0})&&i(r)&&i(s))return[e,t,+n];alert("Invalid input, please try again!")}clearInputs(){this.titleInputElement.value="",this.descriptionInputElement.value="",this.peopleInputElement.value=""}submitHandler(e){e.preventDefault();const t=this.gatherUserInput();if(!Array.isArray(t))throw new Error("Values is not valid!");const[n,r,s]=t;this.projectStateContainer.addProject(n,r,s),this.clearInputs()}configure(){this.element.addEventListener("submit",this.submitHandler)}renderContent(){}static initForm(e){return new this(e)}}l([s],a.prototype,"submitHandler",null),function(e){e[e.Active=0]="Active",e[e.Finished=1]="Finished"}(o||(o={}));var c=function(e,t,n,r){var s,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o};class u extends r{constructor(e,t){super("single-project",e,!1,t.id),this.project=t,this.configure(),this.renderContent()}get persons(){return 1===this.project.people?"1 person":this.project.people+" persons"}dragStartHandler(e){e.dataTransfer.setData("text/plain",this.project.id),e.dataTransfer.effectAllowed="move"}dragEndHandler(e){console.log("DragEnd")}configure(){this.element.addEventListener("dragstart",this.dragStartHandler),this.element.addEventListener("dragend",this.dragStartHandler)}renderContent(){this.element.querySelector("h2").textContent=this.project.title,this.element.querySelector("h3").textContent=this.persons+" assigned",this.element.querySelector("h2").textContent=this.project.title}}c([s],u.prototype,"dragStartHandler",null);var d=function(e,t,n,r){var s,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o};class p extends r{constructor(e,t){super("project-list","app",!1,e+"-projects"),this.projectStateContainer=t,this.type=e,this.assignedProjects=[],this.configure(),this.renderContent()}dragOverHandler(e){if(e.dataTransfer&&e.dataTransfer.types.length&&"text/plain"===e.dataTransfer.types[0]){e.preventDefault();this.element.querySelector("ul").classList.add("droppable")}}dropHandler(e){const t=e.dataTransfer.getData("text/plain"),n="active"===this.type?o.Active:o.Finished;this.projectStateContainer.moveProject(t,n)}dragLeaveHandler(e){this.element.querySelector("ul").classList.remove("droppable")}renderProjects(){document.getElementById(this.type+"-projects-list").innerHTML="";for(const e of this.assignedProjects)new u(this.element.querySelector("ul").id,e)}configure(){this.element.addEventListener("dragover",this.dragOverHandler),this.element.addEventListener("dragleave",this.dragLeaveHandler),this.element.addEventListener("drop",this.dropHandler),this.projectStateContainer.addListener(e=>{const t=e.filter(e=>"active"===this.type?e.status===o.Active:e.status===o.Finished);this.assignedProjects=t,this.renderProjects()})}renderContent(){const e=this.type+"-projects-list";this.element.querySelector("ul").id=e,this.element.querySelector("h2").textContent=this.type.toUpperCase()+" PROJECTS"}}d([s],p.prototype,"dragOverHandler",null),d([s],p.prototype,"dropHandler",null),d([s],p.prototype,"dragLeaveHandler",null);class h{constructor(e,t,n,r,s){this.id=e,this.title=t,this.description=n,this.people=r,this.status=s}}class f extends class{constructor(){this.listeners=[]}addListener(e){this.listeners.push(e)}}{constructor(){super(),this.projects=[]}static getInstance(){return this.instance instanceof f||(this.instance=new f),this.instance}createProject(e,t,n){return new h(Math.random().toString(),e,t,n,o.Active)}addProject(e,t,n){const r=this.createProject(e,t,n);this.projects.push(r),this.updateListeners()}moveProject(e,t){const n=this.projects.find(t=>t.id===e);n instanceof h&&n.status!==t&&(n.status=t,this.updateListeners())}updateListeners(){for(const e of this.listeners)e(this.projects.slice())}}const m=f.getInstance();a.initForm(m),new p("active",m),new p("finished",m)}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL0FwcC9Nb2RlbHMvQmFzZS9Db21wb25lbnQudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL0FwcC9EZWNvcmF0b3JzL0F1dG9iaW5kLnRzIiwid2VicGFjazovLy8uL3NyYy9BcHAvSGVscGVycy9WYWxpZGF0ZUhlbHBlci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvQXBwL01vZGVscy9CYXNlL1R5cGVzLnRzIiwid2VicGFjazovLy8uL3NyYy9BcHAvTW9kZWxzL1Byb2plY3RJbnB1dC50cyIsIndlYnBhY2s6Ly8vLi9zcmMvQXBwL01vZGVscy9Qcm9qZWN0SXRlbS50cyIsIndlYnBhY2s6Ly8vLi9zcmMvQXBwL01vZGVscy9Qcm9qZWN0TGlzdC50cyIsIndlYnBhY2s6Ly8vLi9zcmMvQXBwL01vZGVscy9Qcm9qZWN0LnRzIiwid2VicGFjazovLy8uL3NyYy9BcHAvTW9kZWxzL1Byb2plY3RTdGF0ZS50cyIsIndlYnBhY2s6Ly8vLi9zcmMvQXBwL01vZGVscy9CYXNlL1N0YXRlLnRzIiwid2VicGFjazovLy8uL3NyYy9hcHAudHMiXSwibmFtZXMiOlsiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJpIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsInQiLCJtb2RlIiwiX19lc01vZHVsZSIsIm5zIiwiY3JlYXRlIiwia2V5IiwiYmluZCIsIm4iLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJDb21wb25lbnQiLCJ0ZW1wbGF0ZUlkIiwiaG9zdElkIiwiaW5zZXJ0SW5CZWdpbm5pbmciLCJuZXdFbGVtZW50SWQiLCJ0ZW1wbGF0ZUVsZW1lbnQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiaG9zdEVsZW1lbnQiLCJIVE1MVGVtcGxhdGVFbGVtZW50IiwiRXJyb3IiLCJIVE1MRWxlbWVudCIsInRoaXMiLCJpbXBvcnRlZE5vZGUiLCJpbXBvcnROb2RlIiwiY29udGVudCIsImVsZW1lbnQiLCJmaXJzdEVsZW1lbnRDaGlsZCIsImlkIiwiYXR0YWNoIiwicG9zdGl0aW9uIiwiaW5zZXJ0QWRqYWNlbnRFbGVtZW50IiwiQXV0b2JpbmQiLCJfdGFyZ2V0IiwiX21ldGhvZE5hbWUiLCJkZXNjcmlwdG9yIiwib3JpZ2luTWV0aG9kIiwiY29uZmlndXJhYmxlIiwidmFsaWRhdGUiLCJ2YWxpZGF0YWJsZUlucHV0IiwiaXNWYWxpZCIsInJlcXVpcmVkIiwidG9TdHJpbmciLCJ0cmltIiwibGVuZ3RoIiwibWluTGVuZ3RoIiwibWF4TGVuZ3RoIiwibWluIiwibWF4IiwiUHJvamVjdFN0YXR1cyIsInByb2plY3RTdGF0ZUNvbnRhaW5lciIsInN1cGVyIiwidGl0bGVJbnB1dEVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiZGVzY3JpcHRpb25JbnB1dEVsZW1lbnQiLCJwZW9wbGVJbnB1dEVsZW1lbnQiLCJjb25maWd1cmUiLCJlbnRlcmVkVGl0bGUiLCJlbnRlcmVkRGVzY3JpcHRpb24iLCJlbnRlcmVkUGVvcGxlIiwiZGVzY3JpcHRpb25WYWxpZGF0YWJsZSIsInBlb3BsZVZhbGlkYXRhYmxlIiwiYWxlcnQiLCJldmVudCIsInByZXZlbnREZWZhdWx0IiwidXNlcklucHV0IiwiZ2F0aGVyVXNlcklucHV0IiwiQXJyYXkiLCJpc0FycmF5IiwidGl0bGUiLCJkZXNjIiwicGVvcGxlIiwiYWRkUHJvamVjdCIsImNsZWFySW5wdXRzIiwiYWRkRXZlbnRMaXN0ZW5lciIsInN1Ym1pdEhhbmRsZXIiLCJwcm9qZWN0IiwicmVuZGVyQ29udGVudCIsImRhdGFUcmFuc2ZlciIsInNldERhdGEiLCJlZmZlY3RBbGxvd2VkIiwiXyIsImNvbnNvbGUiLCJsb2ciLCJkcmFnU3RhcnRIYW5kbGVyIiwidGV4dENvbnRlbnQiLCJwZXJzb25zIiwidHlwZSIsImFzc2lnbmVkUHJvamVjdHMiLCJ0eXBlcyIsImNsYXNzTGlzdCIsImFkZCIsInByaklkIiwiZ2V0RGF0YSIsIkFjdGl2ZSIsIkZpbmlzaGVkIiwibW92ZVByb2plY3QiLCJyZW1vdmUiLCJpbm5lckhUTUwiLCJwcmpJdGVtIiwiZHJhZ092ZXJIYW5kbGVyIiwiZHJhZ0xlYXZlSGFuZGxlciIsImRyb3BIYW5kbGVyIiwiYWRkTGlzdGVuZXIiLCJwcm9qZWN0cyIsInJlbGV2YW50UHJvamVjdHMiLCJmaWx0ZXIiLCJwcmoiLCJzdGF0dXMiLCJyZW5kZXJQcm9qZWN0cyIsImxpc3RJZCIsInRvVXBwZXJDYXNlIiwiUHJvamVjdCIsImRlc2NyaXB0aW9uIiwibGlzdGVuZXJzIiwibGlzdGVuZXIiLCJwdXNoIiwiaW5zdGFuY2UiLCJudW1iZXJPZlBlb3BsZSIsIk1hdGgiLCJyYW5kb20iLCJuZXdQcm9qZWN0IiwiY3JlYXRlUHJvamVjdCIsInVwZGF0ZUxpc3RlbmVycyIsInByb2plY3RJZCIsIm5ld1N0YXR1cyIsImZpbmQiLCJsaXN0ZXJGbiIsInNsaWNlIiwiZ2V0SW5zdGFuY2UiLCJpbml0Rm9ybSJdLCJtYXBwaW5ncyI6ImFBQ0UsSUFBSUEsRUFBbUIsR0FHdkIsU0FBU0MsRUFBb0JDLEdBRzVCLEdBQUdGLEVBQWlCRSxHQUNuQixPQUFPRixFQUFpQkUsR0FBVUMsUUFHbkMsSUFBSUMsRUFBU0osRUFBaUJFLEdBQVksQ0FDekNHLEVBQUdILEVBQ0hJLEdBQUcsRUFDSEgsUUFBUyxJQVVWLE9BTkFJLEVBQVFMLEdBQVVNLEtBQUtKLEVBQU9ELFFBQVNDLEVBQVFBLEVBQU9ELFFBQVNGLEdBRy9ERyxFQUFPRSxHQUFJLEVBR0pGLEVBQU9ELFFBS2ZGLEVBQW9CUSxFQUFJRixFQUd4Qk4sRUFBb0JTLEVBQUlWLEVBR3hCQyxF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Y0FFM0MsRUFBYUMsU0FBU2hGLEdBRXRCLElBQUksRUFBWSxTQUFVQSxHQUMxQixJQUFJLEVBQVksV0FBWUEiLCJmaWxlIjoiYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJkaXN0XCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsImV4cG9ydCBkZWZhdWx0IGFic3RyYWN0IGNsYXNzIENvbXBvbmVudDxUIGV4dGVuZHMgSFRNTEVsZW1lbnQsIFUgZXh0ZW5kcyBIVE1MRWxlbWVudD4ge1xyXG4gICAgcHJpdmF0ZSB0ZW1wbGF0ZUVsZW1lbnQ6IEhUTUxUZW1wbGF0ZUVsZW1lbnQ7XHJcbiAgICBwcml2YXRlIGhvc3RFbGVtZW50OiBUO1xyXG4gICAgcHJvdGVjdGVkIGVsZW1lbnQ6IFU7XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgdGVtcGxhdGVJZDogc3RyaW5nLFxyXG4gICAgICAgIGhvc3RJZDogc3RyaW5nLFxyXG4gICAgICAgIGluc2VydEluQmVnaW5uaW5nOiBib29sZWFuID0gdHJ1ZSxcclxuICAgICAgICBuZXdFbGVtZW50SWQ/OiBzdHJpbmdcclxuICAgICkge1xyXG4gICAgICAgIGNvbnN0XHJcbiAgICAgICAgICAgIHRlbXBsYXRlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRlbXBsYXRlSWQpLFxyXG4gICAgICAgICAgICBob3N0RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGhvc3RJZCk7XHJcblxyXG4gICAgICAgIGlmICghICh0ZW1wbGF0ZUVsZW1lbnQgaW5zdGFuY2VvZiBIVE1MVGVtcGxhdGVFbGVtZW50KSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RlbXBsYXRlIGVsZW1lbnQgaXMgbm90IGRlZmluZWQhJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoISAoaG9zdEVsZW1lbnQgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdIb3N0IGVsZW1lbnQgaXMgbm90IGRlZmluZWQhcycpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy50ZW1wbGF0ZUVsZW1lbnQgPSB0ZW1wbGF0ZUVsZW1lbnQgYXMgSFRNTFRlbXBsYXRlRWxlbWVudDtcclxuICAgICAgICBcclxuICAgICAgICB0aGlzLmhvc3RFbGVtZW50ID0gaG9zdEVsZW1lbnQgYXMgVDtcclxuXHJcbiAgICAgICAgY29uc3QgaW1wb3J0ZWROb2RlID0gZG9jdW1lbnQuaW1wb3J0Tm9kZSh0aGlzLnRlbXBsYXRlRWxlbWVudC5jb250ZW50LCB0cnVlKTtcclxuXHJcbiAgICAgICAgdGhpcy5lbGVtZW50ID0gaW1wb3J0ZWROb2RlLmZpcnN0RWxlbWVudENoaWxkIGFzIFU7XHJcblxyXG4gICAgICAgIGlmIChuZXdFbGVtZW50SWQpIHtcclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmlkID0gbmV3RWxlbWVudElkO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5hdHRhY2goaW5zZXJ0SW5CZWdpbm5pbmcpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYXR0YWNoKGluc2VydEluQmVnaW5uaW5nOiBib29sZWFuKTogdm9pZFxyXG4gICAge1xyXG4gICAgICAgIGNvbnN0IHBvc3RpdGlvbiA9IGluc2VydEluQmVnaW5uaW5nID8gJ2FmdGVyYmVnaW4nIDogJ2JlZm9yZWVuZCc7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdGhpcy5ob3N0RWxlbWVudC5pbnNlcnRBZGphY2VudEVsZW1lbnQocG9zdGl0aW9uLCB0aGlzLmVsZW1lbnQpO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBhYnN0cmFjdCBjb25maWd1cmUoKTogdm9pZDtcclxuICAgIHByb3RlY3RlZCBhYnN0cmFjdCByZW5kZXJDb250ZW50KCk6IHZvaWQ7XHJcbn0iLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBBdXRvYmluZChcclxuICAgIF90YXJnZXQ6YW55LFxyXG4gICAgX21ldGhvZE5hbWU6IHN0cmluZyxcclxuICAgIGRlc2NyaXB0b3I6IFByb3BlcnR5RGVzY3JpcHRvclxyXG4pIHtcclxuICAgIGNvbnN0IG9yaWdpbk1ldGhvZCA9IGRlc2NyaXB0b3IudmFsdWU7XHJcbiAgICBjb25zdCBhZGpEZXNjcmlwdG9yOiBQcm9wZXJ0eURlc2NyaXB0b3IgPSB7XHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGdldCgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG9yaWdpbk1ldGhvZC5iaW5kKHRoaXMpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gYWRqRGVzY3JpcHRvcjtcclxufSIsImltcG9ydCBWYWxpZGF0YWJsZSBmcm9tICcuLi9Nb2RlbHMvQmFzZS9WYWxpZGF0YWJsZSc7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGUodmFsaWRhdGFibGVJbnB1dDogVmFsaWRhdGFibGUpIHtcclxuICAgIGxldCBpc1ZhbGlkID0gdHJ1ZTtcclxuXHJcbiAgICBpZiAodmFsaWRhdGFibGVJbnB1dC5yZXF1aXJlZCkge1xyXG4gICAgICAgIGlzVmFsaWQgPSBpc1ZhbGlkICYmIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUudG9TdHJpbmcoKS50cmltKCkubGVuZ3RoICE9PSAwO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh2YWxpZGF0YWJsZUlucHV0Lm1pbkxlbmd0aCAhPSBudWxsICYmIHR5cGVvZiB2YWxpZGF0YWJsZUlucHV0LnZhbHVlID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgIGlzVmFsaWQgPSBpc1ZhbGlkICYmIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUubGVuZ3RoID49IHZhbGlkYXRhYmxlSW5wdXQubWluTGVuZ3RoO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh2YWxpZGF0YWJsZUlucHV0Lm1heExlbmd0aCAhPSBudWxsICYmIHR5cGVvZiB2YWxpZGF0YWJsZUlucHV0LnZhbHVlID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgIGlzVmFsaWQgPSBpc1ZhbGlkICYmIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUubGVuZ3RoIDw9IHZhbGlkYXRhYmxlSW5wdXQubWF4TGVuZ3RoO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh2YWxpZGF0YWJsZUlucHV0Lm1pbiAhPSBudWxsICYmIHR5cGVvZiB2YWxpZGF0YWJsZUlucHV0LnZhbHVlID09PSAnbnVtYmVyJykge1xyXG4gICAgICAgIGlzVmFsaWQgPSBpc1ZhbGlkICYmIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUgPj0gdmFsaWRhdGFibGVJbnB1dC5taW47XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHZhbGlkYXRhYmxlSW5wdXQubWF4ICE9IG51bGwgJiYgdHlwZW9mIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUgPT09ICdudW1iZXInKSB7XHJcbiAgICAgICAgaXNWYWxpZCA9IGlzVmFsaWQgJiYgdmFsaWRhdGFibGVJbnB1dC52YWx1ZSA8PSB2YWxpZGF0YWJsZUlucHV0Lm1heDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gaXNWYWxpZDtcclxufSIsImV4cG9ydCB0eXBlIEJhc2VQcm9qZWN0ID0ge1xyXG4gICAgaWQ6IHN0cmluZyxcclxuICAgIHRpdGxlOiBzdHJpbmcsXHJcbiAgICBkZXNjcmlwdGlvbjogc3RyaW5nLFxyXG4gICAgcGVvcGxlOiBudW1iZXIsXHJcbn07XHJcblxyXG5leHBvcnQgZW51bSBQcm9qZWN0U3RhdHVzIHsgQWN0aXZlLCBGaW5pc2hlZCB9XHJcblxyXG5leHBvcnQgdHlwZSBMaXN0ZW5lcjxUPiA9IChpdGVtczogVFtdKSA9PiB2b2lkO1xyXG5cclxuZXhwb3J0IHR5cGUgU3Rhc3VzYWJsZSA9ICdhY3RpdmUnIHwgJ2ZpbmlzaGVkJzsiLCJpbXBvcnQgUHJvamVjdFN0YXRlIGZyb20gJy4vUHJvamVjdFN0YXRlJztcclxuaW1wb3J0IENvbXBvbmVudCBmcm9tICcuL0Jhc2UvQ29tcG9uZW50JztcclxuaW1wb3J0IEF1dG9iaW5kIGZyb20gJy4uL0RlY29yYXRvcnMvQXV0b2JpbmQnO1xyXG5pbXBvcnQgVmFsaWRhdGFibGUgZnJvbSAnLi9CYXNlL1ZhbGlkYXRhYmxlJztcclxuaW1wb3J0IHsgdmFsaWRhdGUgfSBmcm9tICcuLi9IZWxwZXJzL1ZhbGlkYXRlSGVscGVyJztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFByb2plY3RJbnB1dCBleHRlbmRzIENvbXBvbmVudDxIVE1MRGl2RWxlbWVudCwgSFRNTEZvcm1FbGVtZW50PlxyXG57XHJcbiAgICBwcml2YXRlIHRpdGxlSW5wdXRFbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50O1xyXG4gICAgcHJpdmF0ZSBkZXNjcmlwdGlvbklucHV0RWxlbWVudDogSFRNTElucHV0RWxlbWVudDtcclxuICAgIHByaXZhdGUgcGVvcGxlSW5wdXRFbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50O1xyXG4gICAgcHJpdmF0ZSBwcm9qZWN0U3RhdGVDb250YWluZXI6IFByb2plY3RTdGF0ZTtcclxuICAgIFxyXG4gICAgcHJpdmF0ZSBjb25zdHJ1Y3Rvcihwcm9qZWN0U3RhdGVDb250YWluZXI6IFByb2plY3RTdGF0ZSlcclxuICAgIHtcclxuICAgICAgICBzdXBlcigncHJvamVjdC1pbnB1dCcsICdhcHAnLCB0cnVlLCAndXNlci1pbnB1dCcpO1xyXG5cclxuICAgICAgICB0aGlzLnByb2plY3RTdGF0ZUNvbnRhaW5lciA9IHByb2plY3RTdGF0ZUNvbnRhaW5lcjtcclxuXHJcbiAgICAgICAgdGhpcy50aXRsZUlucHV0RWxlbWVudCA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcjdGl0bGUnKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xyXG4gICAgICAgIHRoaXMuZGVzY3JpcHRpb25JbnB1dEVsZW1lbnQgPSB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcignI2Rlc2NyaXB0aW9uJykgYXMgSFRNTElucHV0RWxlbWVudDtcclxuICAgICAgICB0aGlzLnBlb3BsZUlucHV0RWxlbWVudCA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcjcGVvcGxlJykgYXMgSFRNTElucHV0RWxlbWVudDtcclxuXHJcbiAgICAgICAgdGhpcy5jb25maWd1cmUoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdhdGhlclVzZXJJbnB1dCgpOiBbc3RyaW5nLCBzdHJpbmcsIG51bWJlcl0gfCB2b2lkXHJcbiAgICB7XHJcbiAgICAgICAgY29uc3RcclxuICAgICAgICAgICAgZW50ZXJlZFRpdGxlID0gdGhpcy50aXRsZUlucHV0RWxlbWVudC52YWx1ZSxcclxuICAgICAgICAgICAgZW50ZXJlZERlc2NyaXB0aW9uID0gdGhpcy5kZXNjcmlwdGlvbklucHV0RWxlbWVudC52YWx1ZSxcclxuICAgICAgICAgICAgZW50ZXJlZFBlb3BsZSA9IHRoaXMucGVvcGxlSW5wdXRFbGVtZW50LnZhbHVlO1xyXG5cclxuICAgICAgICBjb25zdCB0aXRsZVZhbGlkYXRhYmxlOiBWYWxpZGF0YWJsZSA9IHtcclxuICAgICAgICAgICAgdmFsdWU6IGVudGVyZWRUaXRsZSxcclxuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgY29uc3QgZGVzY3JpcHRpb25WYWxpZGF0YWJsZTogVmFsaWRhdGFibGUgPSB7XHJcbiAgICAgICAgICAgIHZhbHVlOiBlbnRlcmVkRGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxyXG4gICAgICAgICAgICBtaW5MZW5ndGg6IDUsXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgY29uc3QgcGVvcGxlVmFsaWRhdGFibGU6IFZhbGlkYXRhYmxlID0ge1xyXG4gICAgICAgICAgICB2YWx1ZTogK2VudGVyZWRQZW9wbGUsXHJcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxyXG4gICAgICAgICAgICBtaW46IDEsXHJcbiAgICAgICAgICAgIG1heDogNSxcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgICEgdmFsaWRhdGUodGl0bGVWYWxpZGF0YWJsZSkgfHxcclxuICAgICAgICAgICAgISB2YWxpZGF0ZShkZXNjcmlwdGlvblZhbGlkYXRhYmxlKSB8fFxyXG4gICAgICAgICAgICAhIHZhbGlkYXRlKHBlb3BsZVZhbGlkYXRhYmxlKVxyXG4gICAgICAgICkge1xyXG4gICAgICAgICAgICBhbGVydCgnSW52YWxpZCBpbnB1dCwgcGxlYXNlIHRyeSBhZ2FpbiEnKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIFtlbnRlcmVkVGl0bGUsIGVudGVyZWREZXNjcmlwdGlvbiwgK2VudGVyZWRQZW9wbGVdO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY2xlYXJJbnB1dHMoKTogdm9pZFxyXG4gICAge1xyXG4gICAgICAgIHRoaXMudGl0bGVJbnB1dEVsZW1lbnQudmFsdWUgPSAnJztcclxuICAgICAgICB0aGlzLmRlc2NyaXB0aW9uSW5wdXRFbGVtZW50LnZhbHVlID0gJyc7XHJcbiAgICAgICAgdGhpcy5wZW9wbGVJbnB1dEVsZW1lbnQudmFsdWUgPSAnJztcclxuICAgIH1cclxuXHJcbiAgICBAQXV0b2JpbmRcclxuICAgIHByaXZhdGUgc3VibWl0SGFuZGxlcihldmVudDogRXZlbnQpOiB2b2lkXHJcbiAgICB7XHJcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgY29uc3QgdXNlcklucHV0ID0gdGhpcy5nYXRoZXJVc2VySW5wdXQoKTtcclxuXHJcbiAgICAgICAgaWYgKCEgQXJyYXkuaXNBcnJheSh1c2VySW5wdXQpKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVmFsdWVzIGlzIG5vdCB2YWxpZCEnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IFt0aXRsZSwgZGVzYywgcGVvcGxlXSA9IHVzZXJJbnB1dDtcclxuXHJcbiAgICAgICAgdGhpcy5wcm9qZWN0U3RhdGVDb250YWluZXIuYWRkUHJvamVjdCh0aXRsZSwgZGVzYywgcGVvcGxlKTtcclxuXHJcbiAgICAgICAgdGhpcy5jbGVhcklucHV0cygpO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBjb25maWd1cmUoKTogdm9pZFxyXG4gICAge1xyXG4gICAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCB0aGlzLnN1Ym1pdEhhbmRsZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCByZW5kZXJDb250ZW50KClcclxuICAgIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBpbml0Rm9ybShwcm9qZWN0U3RhdGVDb250YWluZXI6IFByb2plY3RTdGF0ZSk6IFByb2plY3RJbnB1dFxyXG4gICAge1xyXG4gICAgICAgIGNvbnN0IG1vZGVsID0gbmV3IHRoaXMocHJvamVjdFN0YXRlQ29udGFpbmVyKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG1vZGVsO1xyXG4gICAgfVxyXG59IiwiaW1wb3J0IFByb2plY3QgZnJvbSAnLi9Qcm9qZWN0JztcclxuaW1wb3J0IENvbXBvbmVudCBmcm9tICcuL0Jhc2UvQ29tcG9uZW50JztcclxuaW1wb3J0IEF1dG9iaW5kIGZyb20gJy4uL0RlY29yYXRvcnMvQXV0b2JpbmQnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUHJvamVjdEl0ZW0gZXh0ZW5kcyBDb21wb25lbnQ8SFRNTFVMaXN0RWxlbWVudCwgSFRNTExJRWxlbWVudD5cclxuICAgIGltcGxlbWVudHMgRHJhZ2dhYmxlXHJcbntcclxuICAgIHByaXZhdGUgcHJvamVjdDogUHJvamVjdDtcclxuXHJcbiAgICBnZXQgcGVyc29ucygpXHJcbiAgICB7XHJcbiAgICAgICAgaWYgKHRoaXMucHJvamVjdC5wZW9wbGUgPT09IDEpIHtcclxuICAgICAgICAgICAgcmV0dXJuICcxIHBlcnNvbic7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gYCR7dGhpcy5wcm9qZWN0LnBlb3BsZX0gcGVyc29uc2A7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGNvbnN0cnVjdG9yKGhvc3RJZDogc3RyaW5nLCBwcm9qZWN0OiBQcm9qZWN0KVxyXG4gICAge1xyXG4gICAgICAgIHN1cGVyKCdzaW5nbGUtcHJvamVjdCcsIGhvc3RJZCwgZmFsc2UsIHByb2plY3QuaWQpO1xyXG4gICAgICAgIHRoaXMucHJvamVjdCA9IHByb2plY3Q7XHJcblxyXG4gICAgICAgIHRoaXMuY29uZmlndXJlKCk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXJDb250ZW50KClcclxuICAgIH1cclxuXHJcbiAgICBAQXV0b2JpbmRcclxuICAgIGRyYWdTdGFydEhhbmRsZXIoZXZlbnQ6IERyYWdFdmVudCk6IHZvaWRcclxuICAgIHtcclxuICAgICAgICBldmVudC5kYXRhVHJhbnNmZXIhLnNldERhdGEoJ3RleHQvcGxhaW4nLCB0aGlzLnByb2plY3QuaWQpO1xyXG4gICAgICAgIGV2ZW50LmRhdGFUcmFuc2ZlciEuZWZmZWN0QWxsb3dlZCA9ICdtb3ZlJztcclxuICAgIH1cclxuXHJcbiAgICBkcmFnRW5kSGFuZGxlcihfOiBEcmFnRXZlbnQpXHJcbiAgICB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ0RyYWdFbmQnKTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgY29uZmlndXJlKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdkcmFnc3RhcnQnLCB0aGlzLmRyYWdTdGFydEhhbmRsZXIpO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdkcmFnZW5kJywgdGhpcy5kcmFnU3RhcnRIYW5kbGVyKTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgcmVuZGVyQ29udGVudCgpOiB2b2lkXHJcbiAgICB7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2gyJykhLnRleHRDb250ZW50ID0gdGhpcy5wcm9qZWN0LnRpdGxlO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCdoMycpIS50ZXh0Q29udGVudCA9IHRoaXMucGVyc29ucyArICcgYXNzaWduZWQnO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCdoMicpIS50ZXh0Q29udGVudCA9IHRoaXMucHJvamVjdC50aXRsZTtcclxuICAgIH1cclxufSIsImltcG9ydCB7IFN0YXN1c2FibGUsIFByb2plY3RTdGF0dXMgfSBmcm9tICcuL0Jhc2UvVHlwZXMnO1xyXG5pbXBvcnQgUHJvamVjdCBmcm9tICcuL1Byb2plY3QnO1xyXG5pbXBvcnQgUHJvamVjdFN0YXRlIGZyb20gJy4vUHJvamVjdFN0YXRlJztcclxuaW1wb3J0IFByb2plY3RJdGVtIGZyb20gJy4vUHJvamVjdEl0ZW0nO1xyXG5pbXBvcnQgQ29tcG9uZW50IGZyb20gJy4vQmFzZS9Db21wb25lbnQnO1xyXG5pbXBvcnQgQXV0b2JpbmQgZnJvbSAnLi4vRGVjb3JhdG9ycy9BdXRvYmluZCc7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQcm9qZWN0TGlzdCBleHRlbmRzIENvbXBvbmVudDxIVE1MRGl2RWxlbWVudCwgSFRNTEVsZW1lbnQ+IGltcGxlbWVudHMgRHJhZ1RhcmdldFxyXG57XHJcbiAgICBwcml2YXRlIHR5cGU6IFN0YXN1c2FibGU7XHJcbiAgICBwcml2YXRlIGFzc2lnbmVkUHJvamVjdHM6IFByb2plY3RbXTtcclxuICAgIHByaXZhdGUgcHJvamVjdFN0YXRlQ29udGFpbmVyOiBQcm9qZWN0U3RhdGU7XHJcbiAgICBcclxuICAgIGNvbnN0cnVjdG9yKHR5cGU6IFN0YXN1c2FibGUsIHByb2plY3RTdGF0ZUNvbnRhaW5lcjogUHJvamVjdFN0YXRlKVxyXG4gICAge1xyXG4gICAgICAgIHN1cGVyKCdwcm9qZWN0LWxpc3QnLCAnYXBwJywgZmFsc2UsIGAke3R5cGV9LXByb2plY3RzYCk7XHJcblxyXG4gICAgICAgIHRoaXMucHJvamVjdFN0YXRlQ29udGFpbmVyID0gcHJvamVjdFN0YXRlQ29udGFpbmVyO1xyXG5cclxuICAgICAgICB0aGlzLnR5cGUgPSB0eXBlO1xyXG5cclxuICAgICAgICB0aGlzLmFzc2lnbmVkUHJvamVjdHMgPSBbXTtcclxuXHJcbiAgICAgICAgdGhpcy5jb25maWd1cmUoKTtcclxuICAgICAgICB0aGlzLnJlbmRlckNvbnRlbnQoKTtcclxuICAgIH1cclxuXHJcbiAgICBAQXV0b2JpbmRcclxuICAgIGRyYWdPdmVySGFuZGxlcihldmVudDogRHJhZ0V2ZW50KTogdm9pZFxyXG4gICAge1xyXG4gICAgICAgIGlmIChcclxuICAgICAgICAgICAgZXZlbnQuZGF0YVRyYW5zZmVyICYmXHJcbiAgICAgICAgICAgIGV2ZW50LmRhdGFUcmFuc2Zlci50eXBlcy5sZW5ndGggJiZcclxuICAgICAgICAgICAgZXZlbnQuZGF0YVRyYW5zZmVyLnR5cGVzWzBdID09PSAndGV4dC9wbGFpbidcclxuICAgICAgICApIHtcclxuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IGxpc3RFbCA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCd1bCcpITtcclxuXHJcbiAgICAgICAgICAgIGxpc3RFbC5jbGFzc0xpc3QuYWRkKCdkcm9wcGFibGUnKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgQEF1dG9iaW5kXHJcbiAgICBkcm9wSGFuZGxlcihldmVudDogRHJhZ0V2ZW50KTogdm9pZFxyXG4gICAge1xyXG4gICAgICAgIGNvbnN0IHByaklkID0gZXZlbnQuZGF0YVRyYW5zZmVyIS5nZXREYXRhKCd0ZXh0L3BsYWluJyk7XHJcblxyXG4gICAgICAgIGNvbnN0IHR5cGUgPSB0aGlzLnR5cGUgPT09ICdhY3RpdmUnID8gUHJvamVjdFN0YXR1cy5BY3RpdmUgOiBQcm9qZWN0U3RhdHVzLkZpbmlzaGVkXHJcblxyXG4gICAgICAgIHRoaXMucHJvamVjdFN0YXRlQ29udGFpbmVyLm1vdmVQcm9qZWN0KHByaklkLCB0eXBlKTtcclxuICAgIH1cclxuXHJcbiAgICBAQXV0b2JpbmRcclxuICAgIGRyYWdMZWF2ZUhhbmRsZXIoXzogRHJhZ0V2ZW50KTogdm9pZFxyXG4gICAge1xyXG4gICAgICAgIGNvbnN0IGxpc3RFbCA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCd1bCcpITtcclxuXHJcbiAgICAgICAgbGlzdEVsLmNsYXNzTGlzdC5yZW1vdmUoJ2Ryb3BwYWJsZScpO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCByZW5kZXJQcm9qZWN0cygpIHtcclxuICAgICAgICBjb25zdCBsaXN0RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgJHt0aGlzLnR5cGV9LXByb2plY3RzLWxpc3RgKSEgYXMgSFRNTFVMaXN0RWxlbWVudDtcclxuXHJcbiAgICAgICAgbGlzdEVsLmlubmVySFRNTCA9ICcnO1xyXG5cclxuICAgICAgICBmb3IgKGNvbnN0IHByakl0ZW0gb2YgdGhpcy5hc3NpZ25lZFByb2plY3RzKSB7XHJcbiAgICAgICAgICAgIG5ldyBQcm9qZWN0SXRlbSh0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcigndWwnKSEuaWQsIHByakl0ZW0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgY29uZmlndXJlKCk6IHZvaWRcclxuICAgIHtcclxuICAgICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ292ZXInLCB0aGlzLmRyYWdPdmVySGFuZGxlcik7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdsZWF2ZScsIHRoaXMuZHJhZ0xlYXZlSGFuZGxlcik7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2Ryb3AnLCB0aGlzLmRyb3BIYW5kbGVyKTtcclxuXHJcbiAgICAgICAgdGhpcy5wcm9qZWN0U3RhdGVDb250YWluZXIuYWRkTGlzdGVuZXIoKHByb2plY3RzOiBQcm9qZWN0W10pID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcmVsZXZhbnRQcm9qZWN0cyA9IHByb2plY3RzLmZpbHRlcihwcmogPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnR5cGUgPT09ICdhY3RpdmUnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwcmouc3RhdHVzID09PSBQcm9qZWN0U3RhdHVzLkFjdGl2ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwcmouc3RhdHVzID09PSBQcm9qZWN0U3RhdHVzLkZpbmlzaGVkO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB0aGlzLmFzc2lnbmVkUHJvamVjdHMgPSByZWxldmFudFByb2plY3RzO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlclByb2plY3RzKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHByb3RlY3RlZCByZW5kZXJDb250ZW50KCk6IHZvaWRcclxuICAgIHtcclxuICAgICAgICBjb25zdCBsaXN0SWQgPSBgJHt0aGlzLnR5cGV9LXByb2plY3RzLWxpc3RgO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKCd1bCcpIS5pZCA9IGxpc3RJZDtcclxuICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcignaDInKSEudGV4dENvbnRlbnQgPSB0aGlzLnR5cGUudG9VcHBlckNhc2UoKSArICcgUFJPSkVDVFMnO1xyXG4gICAgfVxyXG5cclxufSIsImltcG9ydCB7IFByb2plY3RTdGF0dXMgfSBmcm9tICcuL0Jhc2UvVHlwZXMnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUHJvamVjdFxyXG57XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwdWJsaWMgaWQ6IHN0cmluZyxcclxuICAgICAgICBwdWJsaWMgdGl0bGU6IHN0cmluZyxcclxuICAgICAgICBwdWJsaWMgZGVzY3JpcHRpb246IHN0cmluZyxcclxuICAgICAgICBwdWJsaWMgcGVvcGxlOiBudW1iZXIsXHJcbiAgICAgICAgcHVibGljIHN0YXR1czogUHJvamVjdFN0YXR1cyxcclxuICAgICkge1xyXG5cclxuICAgIH1cclxufSIsImltcG9ydCBTdGF0ZSBmcm9tICcuL0Jhc2UvU3RhdGUnO1xyXG5pbXBvcnQgUHJvamVjdCBmcm9tICcuL1Byb2plY3QnO1xyXG5pbXBvcnQgeyBCYXNlUHJvamVjdCwgUHJvamVjdFN0YXR1cyB9IGZyb20gJy4vQmFzZS9UeXBlcyc7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQcm9qZWN0U3RhdGUgZXh0ZW5kcyBTdGF0ZTxQcm9qZWN0PlxyXG57XHJcbiAgICBwcml2YXRlIHByb2plY3RzOiBhbnlbXSA9IFtdO1xyXG5cclxuICAgIHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBQcm9qZWN0U3RhdGU7XHJcblxyXG4gICAgcHJpdmF0ZSBjb25zdHJ1Y3RvcigpXHJcbiAgICB7XHJcbiAgICAgICAgc3VwZXIoKTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgZ2V0SW5zdGFuY2UoKTogUHJvamVjdFN0YXRlXHJcbiAgICB7XHJcbiAgICAgICAgaWYgKHRoaXMuaW5zdGFuY2UgaW5zdGFuY2VvZiBQcm9qZWN0U3RhdGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5zdGFuY2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmluc3RhbmNlID0gbmV3IFByb2plY3RTdGF0ZSgpO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5pbnN0YW5jZTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNyZWF0ZVByb2plY3QodGl0bGU6IHN0cmluZywgZGVzY3JpcHRpb246IHN0cmluZywgbnVtYmVyT2ZQZW9wbGU6IG51bWJlcik6IEJhc2VQcm9qZWN0XHJcbiAgICB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9qZWN0KFxyXG4gICAgICAgICAgICBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKCksXHJcbiAgICAgICAgICAgIHRpdGxlLFxyXG4gICAgICAgICAgICBkZXNjcmlwdGlvbixcclxuICAgICAgICAgICAgbnVtYmVyT2ZQZW9wbGUsXHJcbiAgICAgICAgICAgIFByb2plY3RTdGF0dXMuQWN0aXZlXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgYWRkUHJvamVjdCh0aXRsZTogc3RyaW5nLCBkZXNjcmlwdGlvbjogc3RyaW5nLCBudW1iZXJPZlBlb3BsZTogbnVtYmVyKTogdm9pZFxyXG4gICAge1xyXG4gICAgICAgIGNvbnN0IG5ld1Byb2plY3QgPSB0aGlzLmNyZWF0ZVByb2plY3QodGl0bGUsIGRlc2NyaXB0aW9uLCBudW1iZXJPZlBlb3BsZSk7XHJcblxyXG4gICAgICAgIHRoaXMucHJvamVjdHMucHVzaChuZXdQcm9qZWN0KTtcclxuXHJcbiAgICAgICAgdGhpcy51cGRhdGVMaXN0ZW5lcnMoKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgbW92ZVByb2plY3QocHJvamVjdElkOiBzdHJpbmcsIG5ld1N0YXR1czogUHJvamVjdFN0YXR1cyk6IHZvaWRcclxuICAgIHtcclxuICAgICAgICBjb25zdCBwcm9qZWN0ID0gdGhpcy5wcm9qZWN0cy5maW5kKHByaiA9PiBwcmouaWQgPT09IHByb2plY3RJZCk7XHJcblxyXG4gICAgICAgIGlmICghIChwcm9qZWN0IGluc3RhbmNlb2YgUHJvamVjdCkgfHwgcHJvamVjdC5zdGF0dXMgPT09IG5ld1N0YXR1cykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcm9qZWN0LnN0YXR1cyA9IG5ld1N0YXR1cztcclxuXHJcbiAgICAgICAgdGhpcy51cGRhdGVMaXN0ZW5lcnMoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHVwZGF0ZUxpc3RlbmVycygpOiB2b2lkXHJcbiAgICB7XHJcbiAgICAgICAgZm9yIChjb25zdCBsaXN0ZXJGbiBvZiB0aGlzLmxpc3RlbmVycykge1xyXG4gICAgICAgICAgICBsaXN0ZXJGbih0aGlzLnByb2plY3RzLnNsaWNlKCkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSIsImltcG9ydCB7IExpc3RlbmVyIH0gZnJvbSAnLi9UeXBlcyc7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBhYnN0cmFjdCBjbGFzcyBTdGF0ZTxUPlxyXG57XHJcbiAgICBwcm90ZWN0ZWQgbGlzdGVuZXJzOiBMaXN0ZW5lcjxUPltdID0gW107XHJcbiAgICBcclxuICAgIHB1YmxpYyBhZGRMaXN0ZW5lcihsaXN0ZW5lcjogTGlzdGVuZXI8VD4pOiB2b2lkXHJcbiAgICB7XHJcbiAgICAgICAgdGhpcy5saXN0ZW5lcnMucHVzaChsaXN0ZW5lcik7XHJcbiAgICB9XHJcbn0iLCJpbXBvcnQgUHJvamVjdElucHV0IGZyb20gJy4vQXBwL01vZGVscy9Qcm9qZWN0SW5wdXQnO1xyXG5pbXBvcnQgUHJvamVjdExpc3QgZnJvbSAnLi9BcHAvTW9kZWxzL1Byb2plY3RMaXN0JztcclxuaW1wb3J0IFByb2plY3RTdGF0ZSBmcm9tICcuL0FwcC9Nb2RlbHMvUHJvamVjdFN0YXRlJztcclxuXHJcbmNvbnN0IHByb2plY3RTdGF0ZUNvbnRhaW5lciA9IFByb2plY3RTdGF0ZS5nZXRJbnN0YW5jZSgpO1xyXG5cclxuUHJvamVjdElucHV0LmluaXRGb3JtKHByb2plY3RTdGF0ZUNvbnRhaW5lcik7XHJcblxyXG5uZXcgUHJvamVjdExpc3QoJ2FjdGl2ZScsIHByb2plY3RTdGF0ZUNvbnRhaW5lcik7XHJcbm5ldyBQcm9qZWN0TGlzdCgnZmluaXNoZWQnLCBwcm9qZWN0U3RhdGVDb250YWluZXIpOyJdLCJzb3VyY2VSb290IjoiIn0=